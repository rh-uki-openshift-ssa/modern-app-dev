<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenShift Roadshow Workshop 2024</title>
    <link rel="canonical" href="http://localhost:3000/rhs-openshift-starter-guides/index.html/ocp-roadshow-workshop/4.15/13-networking.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const clusterName = urlParams.get('CLUSTER_SUBDOMAIN');
      const projectName = urlParams.get('PROJECT');
      if (clusterName) {
        showCluster( clusterName );
      }
      else {
        showClusterForm();
      }

      if (projectName) {
        showProject( projectName );
      } else {
        showProjectForm();
      }
    } );


    function sliceCluster(clusterName){
      if (clusterName.length > 70) {
          return "..." + clusterName.slice(35);
      } else {
          return clusterName;
      }
    }

    function showCluster( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('cluster_subdomain').textContent = sliceCluster(clusterName);
      document.getElementById('clusterfield2').value = clusterName;

    }

    function showClusterForm( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
    }

    function gowithcluster() {
      elClusterInput = document.getElementById('clusterfield');
      elProjectInput = document.getElementById('projectfield2');

      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

    function showProject( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "none";
      document.getElementById('navbar-form-project-filled').style.display = "flex";
      document.getElementById('project').textContent = projectName;
      document.getElementById('projectfield2').value = projectName;
    }

    function showProjectForm( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "flex";
      document.getElementById('navbar-form-project-filled').style.display = "none";
    }

    function gowithproject() {
      elProjectInput = document.getElementById('projectfield');
      elClusterInput = document.getElementById('clusterfield2');
      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="http://localhost:3000/rhs-openshift-starter-guides/index.html">OpenShift Roadshow Workshop 2024</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithcluster();">
            <input size="40" id="clusterfield" type="text" placeholder="Enter Cluster Subdomain">
            <input type="hidden" id="projectfield2" name="projectfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="cluster_subdomain"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>

         <div class="navbar-item" id="navbar-form-project-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithproject();">
            <input size="40" id="projectfield" type="text" placeholder="Enter Project Name">
            <input type="hidden" id="clusterfield2" name="clusterfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-project-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="project"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>
<!---
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-scholars.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
--->
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="ocp-roadshow-workshop" data-version="4.15">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">OCP Roadshow Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="xx-workshop-credentials-links.html">Credentials and links</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="10-security-infrastructure-introduction.html">Security &amp; Infrastructure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-application-management-basics.html"><strong>04</strong> - Application Management Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-application-storage-basics.html"><strong>05</strong> - Application Storage Basics</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="13-networking.html"><strong>06</strong> - Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-acs-vulnerability.html"><strong>07</strong> - ACS Vulnerability Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="15-acm.html"><strong>08</strong> - ACM multicluster Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OCP Roadshow Workshop</span>
    <span class="version">4.15</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OCP Roadshow Workshop</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">4.15</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OCP Roadshow Workshop</a></li>
    <li><a href="10-security-infrastructure-introduction.html">Security &amp; Infrastructure</a></li>
    <li><a href="13-networking.html"><strong>06</strong> - Networking</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/marrober/data/git-repos/rhuki-openshift-ssa/modern-app-dev/documentation/modules/ROOT/pages/13-networking.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_openshift_network_policy_based_sdn"><a class="anchor" href="#_openshift_network_policy_based_sdn"></a>OpenShift Network Policy Based SDN</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift&#8217;s default software defined network (SDN) inside the platform is based
on Open vSwitch and is called OpenShiftSDN.</p>
</div>
<div class="paragraph">
<p>However, this cluster has been installed with the CNI compliant OVNKubernetes
SDN. This SDN is based on Open Virtual Network. Moving forward,
this is the perfered SDN to use on OpenShift, and will be the
default in future releases. OVNKubernetes is backwards compatable
with OpenShiftSDN. To read more about OVNKubernetes, please read
<a href="https://docs.openshift.com/container-platform/4.9/networking/ovn_kubernetes_network_provider/about-ovn-kubernetes.html">the official documentation</a>.</p>
</div>
<div class="paragraph">
<p>The SDN is used to provide connectivity between application
components inside of the OpenShift environment. It comes with default network
ranges pre-configured, although you can make changes to these should they
conflict with your existing infrastructure, or for whatever other reason you may
have.</p>
</div>
<div class="paragraph">
<p>Kubernetes <code>NetworkPolicy</code> allows projects to truly isolate their
network infrastructure inside OpenShift’s software defined network. While you
have seen projects isolate resources through OpenShift’s RBAC, the network policy
SDN plugin is able to isolate pods in projects using pod and namespace label selectors.</p>
</div>
<div class="sect2">
<h3 id="_switch_your_project"><a class="anchor" href="#_switch_your_project"></a>Switch Your Project</h3>
<div class="paragraph">
<p>Before continuing, make sure you are using a project that actually exists. If
the last thing you did in the previous lab was delete a project, this will
cause errors in the scripts in this lab.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project default</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_execute_the_creation_script"><a class="anchor" href="#_execute_the_creation_script"></a>Execute the Creation Script</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only users with project or cluster administration privileges can manipulate <strong>Project</strong>
network policies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_clone_the_git_repository_for_content"><a class="anchor" href="#_clone_the_git_repository_for_content"></a>Clone the git repository for content :</h3>
<div class="paragraph">
<p>Run the command below to clone the Git repository of assets.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/rh-uki-openshift-ssa/modern-app-dev.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute a script that we have prepared for you. It will create two
<strong>Projects</strong> and then deploy a <strong>Deployment</strong> with a <strong>Pod</strong> for you:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bash modern-app-dev/support/create-net-projects.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examine_the_created_infrastructure"><a class="anchor" href="#_examine_the_created_infrastructure"></a>Examine the created infrastructure</h3>
<div class="paragraph">
<p>Two <strong>Projects</strong> were created for you, <code>netproj-a</code> and <code>netproj-b</code>. Execute the
following command to see the created resources:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n netproj-a</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a while you will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>NAME           READY   STATUS              RESTARTS   AGE
ose-1-66dz2    0/1     ContainerCreating   0          7s
ose-1-deploy   1/1     Running             0          16s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n netproj-b</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a while you will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>NAME           READY   STATUS      RESTARTS   AGE
ose-1-deploy   0/1     Completed   0          38s
ose-1-vj2gn    1/1     Running     0          30s</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will run commands inside the pod in the <code>netproj-a</code> <strong>Project</strong> that will
connect to TCP port 5000 of the pod in the <code>netproj-b</code> <strong>Project</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_connectivity_should_work"><a class="anchor" href="#_test_connectivity_should_work"></a>Test Connectivity (should work)</h3>
<div class="paragraph">
<p>Now that you have some projects and pods, let&#8217;s test the connectivity between
the pod in the <code>netproj-a</code> <strong>Project</strong> and the pod in the <code>netproj-b</code> <strong>Project</strong>.</p>
</div>
<div class="paragraph">
<p>To test connectivity between the two pods, run:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bash modern-app-dev/support/test-connectivity.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Getting Pod B's IP... 10.129.0.180
Getting Pod A's Name... ose-1-66dz2
Checking connectivity between Pod A and Pod B... worked</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the last line says <code>worked</code>. This means that the pod in the
<code>netproj-a</code> <strong>Project</strong> was able to connect to the pod in the <code>netproj-b</code>
<strong>Project</strong>.</p>
</div>
<div class="paragraph">
<p>This worked because, by default, the networkpolicy lets all pods in all
projects can connect to each other.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restricting_access"><a class="anchor" href="#_restricting_access"></a>Restricting Access</h3>
<div class="paragraph">
<p>With NetworkPolicy, it&#8217;s possible to restrict access in a
project by creating a <code>NetworkPolicy</code> custom resource (CR).</p>
</div>
<div class="paragraph">
<p>For example, the following restricts all access to all pods in a <strong>Project</strong>
where this <code>NetworkPolicy</code> CR is applied. This is the equivalent of a <code>DenyAll</code>
default rule on a firewall:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: deny-by-default
spec:
  podSelector:
  ingress: []</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>podSelector</code> is empty, which means that this will apply to all
pods in this <strong>Project</strong>. Also note that the <code>ingress</code> list is empty, which
means that there are no allowed <code>ingress</code> rules defined by this
<code>NetworkPolicy</code> CR.</p>
</div>
<div class="paragraph">
<p>To restrict access to the pod in the <code>netproj-b</code> <strong>Project</strong> simply apply the
above NetworkPolicy CR with:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -n netproj-b -f modern-app-dev/support/network-policy-block-all.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_connectivity_2_should_fail"><a class="anchor" href="#_test_connectivity_2_should_fail"></a>Test Connectivity #2 (should fail)</h3>
<div class="paragraph">
<p>Since the "block all by default" <code>NetworkPolicy</code> CR has been applied,
connectivity between the pod in the <code>netproj-a</code> <strong>Project</strong> and the pod in the
<code>netproj-b</code> <strong>Project</strong> should now be blocked.</p>
</div>
<div class="paragraph">
<p>Test by running:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bash modern-app-dev/support/test-connectivity.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Getting Pod B's IP... 10.129.0.180
Getting Pod A's Name... ose-1-66dz2
Checking connectivity between Pod A and Pod B............ FAILED!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the last line that says <code>FAILED!</code>. This means that the pod in the
<code>netproj-a</code> <strong>Project</strong> was unable to connect to the pod in the <code>netproj-b</code>
<strong>Project</strong> (as expected).</p>
</div>
<div class="paragraph">
<p>To list all the <code>NetworkPolicy</code> objects, run the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get networkpolicy -n netproj-b</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>NAME              POD-SELECTOR   AGE
deny-by-default   &lt;none&gt;         3m19s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_allow_access"><a class="anchor" href="#_allow_access"></a>Allow Access</h3>
<div class="paragraph">
<p>With NetworkPolicy, it&#8217;s possible to allow access to
individual or groups of pods in a project by creating multiple
<code>NetworkPolicy</code> CRs.</p>
</div>
<div class="paragraph">
<p>The following allows access to port 5000 on TCP for all pods in the project
with the label <code>run: ose</code>. The pod in the <code>netproj-b</code> project has this label.</p>
</div>
<div class="paragraph">
<p>The ingress section specifically allows this access from all projects that
have the label <code>name: netproj-a</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># allow access to TCP port 5000 for pods with the label "run: ose" specifically
# from projects with the label "name: netproj-a".
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: allow-tcp-5000-from-netproj-a-namespace
spec:
  podSelector:
    matchLabels:
      run: ose
  ingress:
  - ports:
    - protocol: TCP
      port: 5000
    from:
    - namespaceSelector:
        matchLabels:
          name: netproj-a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>podSelector</code> is where the local project&#8217;s pods are matched
using a specific label selector.</p>
</div>
<div class="paragraph">
<p>All <code>NetworkPolicy</code> CRs in a project are combined to create the allowed
ingress access for the pods in the project. In this specific case the "deny
all" policy is combined with the "allow TCP 5000" policy.</p>
</div>
<div class="paragraph">
<p>To allow access to the pod in the <code>netproj-b</code> <strong>Project</strong> from all pods in the
<code>netproj-a</code> <strong>Project</strong>, apply the above NetworkPolicy CR with:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -n netproj-b -f modern-app-dev/support/network-policy-allow-all-from-netproj-a.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Listing the <strong>NetworkPolicies</strong>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get networkpolicy -n netproj-b</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should show the new policy in place</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>NAME                                      POD-SELECTOR   AGE
allow-tcp-5000-from-netproj-a-namespace   run=ose        81s
deny-by-default                           &lt;none&gt;         7m11s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_connectivity_3_should_work_again"><a class="anchor" href="#_test_connectivity_3_should_work_again"></a>Test Connectivity #3 (should work again)</h3>
<div class="paragraph">
<p>Since the "allow access from <code>netproj-a</code> on port 5000" NetworkPolicy has been applied,
connectivity between the pod in the <code>netproj-a</code> <strong>Project</strong> and the pod in the
<code>netproj-b</code> <strong>Project</strong> should be allowed again.</p>
</div>
<div class="paragraph">
<p>Test by running:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bash modern-app-dev/support/test-connectivity.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Getting Pod B's IP... 10.129.0.180
Getting Pod A's Name... ose-1-66dz2
Checking connectivity between Pod A and Pod B... worked</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the last line that says <code>worked</code>. This means that the pod in the
<code>netproj-a</code> <strong>Project</strong> was able to connect to the pod in the <code>netproj-b</code>
<strong>Project</strong> (as expected).</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
