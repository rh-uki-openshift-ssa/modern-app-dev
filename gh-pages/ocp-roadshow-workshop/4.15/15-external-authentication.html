<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenShift Roadshow Workshop 2024</title>
    <link rel="canonical" href="http://localhost:3000/rhs-openshift-starter-guides/index.html/ocp-roadshow-workshop/4.15/15-external-authentication.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const clusterName = urlParams.get('CLUSTER_SUBDOMAIN');
      const projectName = urlParams.get('PROJECT');
      if (clusterName) {
        showCluster( clusterName );
      }
      else {
        showClusterForm();
      }

      if (projectName) {
        showProject( projectName );
      } else {
        showProjectForm();
      }
    } );


    function sliceCluster(clusterName){
      if (clusterName.length > 70) {
          return "..." + clusterName.slice(35);
      } else {
          return clusterName;
      }
    }

    function showCluster( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('cluster_subdomain').textContent = sliceCluster(clusterName);
      document.getElementById('clusterfield2').value = clusterName;

    }

    function showClusterForm( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
    }

    function gowithcluster() {
      elClusterInput = document.getElementById('clusterfield');
      elProjectInput = document.getElementById('projectfield2');

      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

    function showProject( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "none";
      document.getElementById('navbar-form-project-filled').style.display = "flex";
      document.getElementById('project').textContent = projectName;
      document.getElementById('projectfield2').value = projectName;
    }

    function showProjectForm( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "flex";
      document.getElementById('navbar-form-project-filled').style.display = "none";
    }

    function gowithproject() {
      elProjectInput = document.getElementById('projectfield');
      elClusterInput = document.getElementById('clusterfield2');
      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="http://localhost:3000/rhs-openshift-starter-guides/index.html">OpenShift Roadshow Workshop 2024</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithcluster();">
            <input size="40" id="clusterfield" type="text" placeholder="Enter Cluster Subdomain">
            <input type="hidden" id="projectfield2" name="projectfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="cluster_subdomain"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>

         <div class="navbar-item" id="navbar-form-project-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithproject();">
            <input size="40" id="projectfield" type="text" placeholder="Enter Project Name">
            <input type="hidden" id="clusterfield2" name="clusterfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-project-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="project"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>
<!---
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-scholars.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
--->
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="ocp-roadshow-workshop" data-version="4.15">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">OCP Roadshow Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-modernisation-introduction.html">Application Migration &amp; Modernisation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-introduction.html"><strong>01</strong> - Migration Workshop Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-assessment.html"><strong>02</strong> - Migration Assessment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-analyze.html"><strong>03</strong> - Migration Analysis</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#08-ocp-ops-intro">MAD Roadshow Ops Track</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-installation-and-verification.html"><strong>01</strong> - Installation and Verificiation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-application-management-basics.html"><strong>02</strong> - Application Management Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-application-storage-basics.html"><strong>03</strong> - Application Storage Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-machinesets-machines-nodes.html"><strong>04</strong> - MachineSets, Machines, and Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-infrastructure-nodes-and-operators.html"><strong>05</strong> - Infrastructure Nodes and Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-openshift-logging-wth-loki.html"><strong>06</strong> - OpenShift Logging with Loki</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="15-external-authentication.html"><strong>07</strong> - External (LDAP) Authentication Providers, Users, and Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="16-openshift-monitoring.html"><strong>08</strong> - OpenShift Monitoring with Prometheus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="17-project-template-quota-limits.html"><strong>09</strong> - Project Request Template, Quotas, Limits</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="18-openshift-networking-networkpolicy.html"><strong>10</strong> - OpenShift Networking and NetworkPolicy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19-disable-self-project-provisioning.html"><strong>11</strong> - Disabling Project Self-Provisioning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20-cluster-resource-quota.html"><strong>12</strong> - Cluster Resource Quotas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="21-taints-tolerations.html"><strong>13</strong> - Taints and Tolerations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="22-vulnerability-scanning-acs.html"><strong>14</strong> - Vulnerability Scanning with ACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="23-devsecops-acs.html"><strong>15</strong> - DevSecOps with ACS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="24-multicluster-with-acm.html"><strong>16</strong> - Multicluster management with ACM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OCP Roadshow Workshop</span>
    <span class="version">4.15</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OCP Roadshow Workshop</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">4.15</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OCP Roadshow Workshop</a></li>
    <li>MAD Roadshow Ops Track</li>
    <li><a href="15-external-authentication.html"><strong>07</strong> - External (LDAP) Authentication Providers, Users, and Groups</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/mkimberl/Documents/source/github/modern-app-dev/documentation/modules/ROOT/pages/15-external-authentication.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="paragraph">
<p>External (LDAP) Authentication Providers, Users, and Groups</p>
</div>
<div class="paragraph">
<p>Configuring External Authentication Providers
OpenShift supports a number of different authentication providers, and you can find the complete list in the understanding identity provider configuration. One of the most commonly used authentication providers is LDAP, whether provided by Microsoft Active Directory or by other sources.</p>
</div>
<div class="paragraph">
<p>OpenShift can perform user authentication against an LDAP server, and can also configure group membership and certain RBAC attributes based on LDAP group membership.</p>
</div>
<div class="paragraph">
<p>Background: LDAP Structure
In this environment we are providing LDAP with the following user groups:</p>
</div>
<div class="paragraph">
<p>ose-user: Users with OpenShift access</p>
</div>
<div class="paragraph">
<p>Any users who should be able to log-in to OpenShift must be members of this group</p>
</div>
<div class="paragraph">
<p>All of the below mentioned users are in this group</p>
</div>
<div class="paragraph">
<p>ose-normal-dev: Normal OpenShift users</p>
</div>
<div class="paragraph">
<p>Regular users of OpenShift without special permissions</p>
</div>
<div class="paragraph">
<p>Contains: normaluser1, teamuser1, teamuser2</p>
</div>
<div class="paragraph">
<p>ose-fancy-dev: Fancy OpenShift users</p>
</div>
<div class="paragraph">
<p>Users of OpenShift that are granted some special privileges</p>
</div>
<div class="paragraph">
<p>Contains: fancyuser1, fancyuser2</p>
</div>
<div class="paragraph">
<p>ose-teamed-app: Teamed app users</p>
</div>
<div class="paragraph">
<p>A group of users that will have access to the same OpenShift Project</p>
</div>
<div class="paragraph">
<p>Contains: teamuser1, teamuser2</p>
</div>
<div class="paragraph">
<p>Examine the OAuth configuration
Since this is a pure, vanilla OpenShift 4 installation, it has the default OAuth resource. You can examine that OAuth configuration with the following:</p>
</div>
<div class="paragraph">
<p>oc get oauth cluster -o yaml
You will see something like:</p>
</div>
<div class="paragraph">
<p>apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  annotations:
    include.release.openshift.io/ibm-cloud-managed: "true"
    include.release.openshift.io/self-managed-high-availability: "true"
    include.release.openshift.io/single-node-developer: "true"
    release.openshift.io/create-only: "true"
  creationTimestamp: "2022-02-09T23:06:59Z"
  generation: 1
  name: cluster
  ownerReferences:
  - apiVersion: config.openshift.io/v1
    kind: ClusterVersion
    name: version
    uid: c9cbd13c-99bf-4e82-b2ad-690810a01f2f
  resourceVersion: "1715"
  uid: 1bedd82d-b235-4e39-af98-e40f411c3c8e
spec: {}
There are a few things to note here. Firstly, there’s basically nothing here! How does the kubeadmin user work, then? The OpenShift OAuth system knows to look for a kubeadmin Secret in the kube-system Namespace. You can examine it with the following:</p>
</div>
<div class="paragraph">
<p>oc get secret -n kube-system kubeadmin -o yaml
You will see something like:</p>
</div>
<div class="paragraph">
<p>apiVersion: v1
data:
  kubeadmin: JDJhJDEwJFYwcVBXRjZGTlNOOU1RYUN6SGtJVGV4T3I5Ym9DbGRTT0VmNS44UGl2cWZOUGdsTnkvb3hT
kind: Secret
metadata:
  creationTimestamp: "2022-02-09T23:06:14Z"
  name: kubeadmin
  namespace: kube-system
  resourceVersion: "576"
  uid: 834a86fd-96e6-4d6a-8c16-6eca251b10f0
type: Opaque
That Secret contains the encoded hash of the kubeadmin password. This account will continue to work even after we configure a new OAuth. If you want to disable it, you would need to delete the secret.</p>
</div>
<div class="paragraph">
<p>In a real-world environment, you will likely want to integrate with your existing identity management solution. For this lab we are configuring LDAP as our identityProvider. Here’s an example of the OAuth configuration. Look for the element in identityProviders with type: LDAP like the following:</p>
</div>
<div class="paragraph">
<p>apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: ldap (1)
    challenge: false
    login: true
    mappingMethod: claim (2)
    type: LDAP
    ldap:
      attributes: (3)
        id:
        - dn
        email:
        - mail
        name:
        - cn
        preferredUsername:
        - uid
      bindDN: "uid=openshiftworkshop,ou=Users,o=5e615ba46b812e7da02e93b5,dc=jumpcloud,dc=com" (4)
      bindPassword: (5)
        name: ldap-secret
      ca: (6)
        name: ca-config-map
      insecure: false
      url: "ldaps://ldap.jumpcloud.com/ou=Users,o=5e615ba46b812e7da02e93b5,dc=jumpcloud,dc=com?uid?sub?(memberOf=cn=ose-user,ou=Users,o=5e615ba46b812e7da02e93b5,dc=jumpcloud,dc=com)" (7)
  tokenConfig:
    accessTokenMaxAgeSeconds: 86400
Some notable fields under identityProviders::</p>
</div>
<div class="paragraph">
<p>name: The unique ID of the identity provider. It is possible to have multiple authentication providers in an OpenShift environment, and OpenShift is able to distinguish between them.</p>
</div>
<div class="paragraph">
<p>mappingMethod: claim: This section has to do with how usernames are assigned within an OpenShift cluster when multiple providers are configured. See the Identity provider parameters section for more information.</p>
</div>
<div class="paragraph">
<p>attributes: This section defines the LDAP fields to iterate over and assign to the fields in the OpenShift user’s "account". If any attributes are not found / not populated when searching through the list, the entire authentication fails. In this case we are creating an identity that is associated with the LDAP dn, an email address from the LDAP mail, a name from the LDAP cn, and a username from the LDAP uid.</p>
</div>
<div class="paragraph">
<p>bindDN: When searching LDAP, bind to the server as this user.</p>
</div>
<div class="paragraph">
<p>bindPassword: Reference to the Secret that has the password to use when binding for searching.</p>
</div>
<div class="paragraph">
<p>ca: Reference to the ConfigMap that contains the CA certificate to use for validating the SSL certificate of the LDAP server.</p>
</div>
<div class="paragraph">
<p>url: Identifies the LDAP server and the search to perform.</p>
</div>
<div class="paragraph">
<p>For more information on the specific details of LDAP authentication in OpenShift you can refer to the Configuring an LDAP identity provider documentation.</p>
</div>
<div class="paragraph">
<p>To setup the LDAP identity provider we must:</p>
</div>
<div class="paragraph">
<p>Create a Secret with the bind password.</p>
</div>
<div class="paragraph">
<p>Create a ConfigMap with the CA certificate.</p>
</div>
<div class="paragraph">
<p>Update the cluster OAuth object with the LDAP identity provider.</p>
</div>
<div class="paragraph">
<p>As the kubeadmin user apply the OAuth configuration with oc.</p>
</div>
<div class="paragraph">
<p>oc login -u kubeadmin -p 4nyNM-BZtvz-Btyng-dTexX
This command will create a Kubernetes secret named "ldap-secret" in the "openshift-config" namespace with a single data item. The data item is named "bindPassword" and its value is set to "b1ndP^ssword"</p>
</div>
<div class="paragraph">
<p>oc create secret generic ldap-secret --from-literal=bindPassword=b1ndP^ssword -n openshift-config
Download the certificate and save it to the file 'ca.crt' with this command:</p>
</div>
<div class="paragraph">
<p>wget <a href="https://certs.godaddy.com/repository/gd-class2-root.crt" class="bare">https://certs.godaddy.com/repository/gd-class2-root.crt</a> -O /opt/app-root/src/support/ca.crt
If you see <code>Unable to establish SSL connection.</code> please click the above command again before proceeding.
Click this command to create a new ConfigMap named ca-config-map in the openshift-config namespace. The ConfigMap is populated with the contents of the file /opt/app-root/src/support/ca.crt. It then applys the file.</p>
</div>
<div class="paragraph">
<p>oc create configmap ca-config-map --from-file=/opt/app-root/src/support/ca.crt -n openshift-config
oc apply -f /opt/app-root/src/support/oauth-cluster.yaml
We use apply because there is an existing OAuth object. If you used create you would get an outright error that the object already exists. You still get a warning, but that’s OK.
This will trigger a redployment of the oAuth Operator. You can monitor the rollout with the following command.</p>
</div>
<div class="paragraph">
<p>oc rollout status deployment/oauth-openshift -n openshift-authentication
Syncing LDAP Groups to OpenShift Groups
In OpenShift, groups can be used to manage users and control permissions for multiple users at once. There is a section in the documentation on how to sync groups with LDAP. Syncing groups involves running a program called groupsync when logged into OpenShift as a user with cluster-admin privileges, and using a configuration file that tells OpenShift what to do with the users it finds in the various groups.</p>
</div>
<div class="paragraph">
<p>We have provided a groupsync configuration file for you:</p>
</div>
<div class="paragraph">
<p>View configuration file</p>
</div>
<div class="paragraph">
<p>cat /opt/app-root/src/support/groupsync.yaml
Without going into too much detail (you can look at the documentation), the groupsync config file does the following:</p>
</div>
<div class="paragraph">
<p>searches LDAP using the specified bind user and password</p>
</div>
<div class="paragraph">
<p>queries for any LDAP groups whose name begins with ose-</p>
</div>
<div class="paragraph">
<p>creates OpenShift groups with a name from the cn of the LDAP group</p>
</div>
<div class="paragraph">
<p>finds the members of the LDAP group and then puts them into the created OpenShift group</p>
</div>
<div class="paragraph">
<p>uses the dn and uid as the UID and name attributes, respectively, in OpenShift</p>
</div>
<div class="paragraph">
<p>Execute the groupsync:</p>
</div>
<div class="paragraph">
<p>oc adm groups sync --sync-config=/opt/app-root/src/support/groupsync.yaml --confirm
You will see output like the following:</p>
</div>
<div class="paragraph">
<p>group/ose-fancy-dev
group/ose-user
group/ose-normal-dev
group/ose-teamed-app
What you are seeing is the Group objects that have been created by the groupsync command. If you are curious about the --confirm flag, check the output of the help with oc adm groups sync -h.</p>
</div>
<div class="paragraph">
<p>If you want to see the Groups that were created, execute the following:</p>
</div>
<div class="paragraph">
<p>oc get groups
You will see output like the following:</p>
</div>
<div class="paragraph">
<p>NAME             USERS
ose-fancy-dev    fancyuser1, fancyuser2
ose-normal-dev   normaluser1, teamuser1, teamuser2
ose-teamed-app   teamuser1, teamuser2
ose-user         fancyuser1, fancyuser2, normaluser1, teamuser1, teamuser2
Take a look at a specific group in YAML:</p>
</div>
<div class="paragraph">
<p>oc get group ose-fancy-dev -o yaml
The YAML looks like:</p>
</div>
<div class="paragraph">
<p>apiVersion: user.openshift.io/v1
kind: Group
metadata:
  annotations:
    openshift.io/ldap.sync-time: "2022-02-10T01:49:07Z"
    openshift.io/ldap.uid: cn=ose-fancy-dev,ou=Users,o=5e615ba46b812e7da02e93b5,dc=jumpcloud,dc=com
    openshift.io/ldap.url: ldap.jumpcloud.com:636
  creationTimestamp: "2022-02-10T01:49:07Z"
  labels:
    openshift.io/ldap.host: ldap.jumpcloud.com
  name: ose-fancy-dev
  resourceVersion: "68628"
  uid: 374c463a-bdd2-4da1-ae1a-619eca0994f6
users:
- fancyuser1
- fancyuser2
OpenShift has automatically associated some LDAP metadata with the Group, and has listed the users who are in the group.</p>
</div>
<div class="paragraph">
<p>What happens if you list the Users?</p>
</div>
<div class="paragraph">
<p>oc get user
You will get:</p>
</div>
<div class="paragraph">
<p>No resources found.
Why would there be no Users found? They are clearly listed in the Group definition.</p>
</div>
<div class="paragraph">
<p>Users are not actually created until the first time they try to log in. What you are seeing in the Group definition is simply a placeholder telling OpenShift that, if it encounters a User with that specific ID, that it should be associated with the Group.</p>
</div>
<div class="paragraph">
<p>Change Group Policy
In your environment, there is a special group of super developers called ose-fancy-dev who should have special cluster-reader privileges. This is a role that allows a user to view administrative-level information about the cluster. For example, they can see the list of all Projects in the cluster.</p>
</div>
<div class="paragraph">
<p>Change the policy for the ose-fancy-dev Group:</p>
</div>
<div class="paragraph">
<p>oc adm policy add-cluster-role-to-group cluster-reader ose-fancy-dev
If you are interested in the different roles that come with OpenShift, you can learn more about them in the role-based access control (RBAC) documentation.
Examine cluster-reader policy
Go ahead and login as a regular user: (if you get an error, wait a few minutes and try again)</p>
</div>
<div class="paragraph">
<p>oc login -u normaluser1 -p Op#nSh1ft
Then, try to list Projects:</p>
</div>
<div class="paragraph">
<p>oc get projects
You will see:</p>
</div>
<div class="paragraph">
<p>No resources found.
Now, login as a member of ose-fancy-dev:</p>
</div>
<div class="paragraph">
<p>oc login -u fancyuser1 -p Op#nSh1ft
And then perform the same oc get projects command:</p>
</div>
<div class="paragraph">
<p>oc get projects
You will now see the list of all of the projects in the cluster:</p>
</div>
<div class="paragraph">
<p>[~] $ oc get projects
NAME                                               DISPLAY NAME   STATUS
default                                                           Active
kube-node-lease                                                   Active
kube-public                                                       Active
kube-system                                                       Active
lab-ocp-cns                                                       Active
openshift                                                         Active
openshift-apiserver                                               Active
&#8230;&#8203;
You should now be starting to understand how RBAC in OpenShift Container Platform can work.</p>
</div>
<div class="paragraph">
<p>Create Projects for Collaboration
Make sure you login as the cluster administrator:</p>
</div>
<div class="paragraph">
<p>oc login -u kubeadmin -p 4nyNM-BZtvz-Btyng-dTexX
Then, create several Projects for people to collaborate:</p>
</div>
<div class="paragraph">
<p>oc adm new-project app-dev --display-name="Application Development"
oc adm new-project app-test --display-name="Application Testing"
oc adm new-project app-prod --display-name="Application Production"
You have now created several Projects that represent a typical Software Development Lifecycle setup. Next, you will configure Groups to grant collaborative access to these projects.</p>
</div>
<div class="paragraph">
<p>Creating projects with oc adm new-project does not use the project request process or the project request template. These projects will not have quotas or limitranges applied by default. A cluster administrator can "impersonate" other users, so there are several options if you wanted these projects to get quotas/limit ranges:</p>
</div>
<div class="paragraph">
<p>use --as to specify impersonating a regular user with oc new-project</p>
</div>
<div class="paragraph">
<p>use oc process and provide values for the project request template, piping into create (eg: oc process …​ | oc create -f -). This will create all of the objects in the project request template, which would include the quota and limit range.</p>
</div>
<div class="paragraph">
<p>manually create/define the quota and limit ranges after creating the projects.
For these exercises it is not important to have quotas or limit ranges on these projects.
Map Groups to Projects
As you saw earlier, there are several roles within OpenShift that are preconfigured. When it comes to Projects, you similarly can grant view, edit, or administrative access. Let’s give our ose-teamed-app users access to edit the development and testing projects:</p>
</div>
<div class="paragraph">
<p>oc adm policy add-role-to-group edit ose-teamed-app -n app-dev
oc adm policy add-role-to-group edit ose-teamed-app -n app-test
And then give them access to view production:</p>
</div>
<div class="paragraph">
<p>oc adm policy add-role-to-group view ose-teamed-app -n app-prod
Now, give the ose-fancy-dev group edit access to the production project:</p>
</div>
<div class="paragraph">
<p>oc adm policy add-role-to-group edit ose-fancy-dev -n app-prod
Examine Group Access
Log in as normaluser1 and see what Projects you can see:</p>
</div>
<div class="paragraph">
<p>oc login -u normaluser1 -p Op#nSh1ft
oc get projects
You should get:</p>
</div>
<div class="paragraph">
<p>No resources found.
Then, try teamuser1 from the ose-teamed-app group:</p>
</div>
<div class="paragraph">
<p>oc login -u teamuser1 -p Op#nSh1ft
oc get projects
You should get:</p>
</div>
<div class="paragraph">
<p>NAME       DISPLAY NAME              STATUS
app-dev    Application Development   Active
app-prod   Application Production    Active
app-test   Application Testing       Active
You did not grant the team users edit access to the production project. Go ahead and try to create something in the production project as teamuser1:</p>
</div>
<div class="paragraph">
<p>oc project app-prod
oc new-app docker.io/siamaksade/mapit
You will see that it will not work:</p>
</div>
<div class="paragraph">
<p>error: can&#8217;t lookup images: imagestreamimports.image.openshift.io is forbidden: User "teamuser1" cannot create resource "imagestreamimports" in API group "image.openshift.io" in the namespace "app-prod"
error:  local file access failed with: stat docker.io/siamaksade/mapit: no such file or directory
error: unable to locate any images in image streams, templates loaded in accessible projects, template files, local docker images with name "docker.io/siamaksade/mapit"</p>
</div>
<div class="paragraph">
<p>Argument 'docker.io/siamaksade/mapit' was classified as an image, image~source, or loaded template reference.</p>
</div>
<div class="paragraph">
<p>The 'oc new-app' command will match arguments to the following types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Images tagged into image streams in the current project or the 'openshift' project</p>
<div class="ulist">
<ul>
<li>
<p>if you don&#8217;t specify a tag, we&#8217;ll add ':latest'</p>
</li>
</ul>
</div>
</li>
<li>
<p>Images in the Docker Hub, on remote registries, or on the local Docker engine</p>
</li>
<li>
<p>Templates in the current project or the 'openshift' project</p>
</li>
<li>
<p>Git repository URLs or local paths that point to Git repositories</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>--allow-missing-images can be used to point to an image that does not exist yet.</p>
</div>
<div class="paragraph">
<p>See 'oc new-app -h' for examples.
This failure is exactly what we wanted to see.</p>
</div>
<div class="paragraph">
<p>Prometheus
Users can utilize Prometheus with LDAP integration to enhance authentication and authorization capabilities. By configuring Prometheus to authenticate against an LDAP server, users can ensure secure access to Prometheus with their LDAP credentials. Additionally, LDAP integration allows administrators to define fine-grained access control policies, granting or restricting Prometheus functionalities based on LDAP user groups or attributes. This enables seamless integration of Prometheus into an LDAP-managed environment, providing centralized user management and access control for monitoring and alerting operations.</p>
</div>
<div class="paragraph">
<p>After you are done, make sure to login again as the admin user:</p>
</div>
<div class="paragraph">
<p>oc login -u kubeadmin -p 4nyNM-BZtvz-Btyng-dTexX
That concludes the LDAP module. Thanks for working through it!</p>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
